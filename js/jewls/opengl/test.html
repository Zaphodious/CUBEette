<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
    </head>
    <body>
        <canvas id="c" height=320 width=320 style="width: 640px; height: 640px;">no canvas fo you</canvas>
        <script type="module">
            import * as gl from "./opengl.mjs";

            let c = document.getElementById("c");
            render(c);

            async function render(c) {
                await gl.initContext(c);
                let img = await loadImage('/carts/democart/assets/santasprites.png');
                let json = await loadJson('/carts/democart/assets/sampmap.json');

                let layers = parseMap(json);

                gl.createCamera('main', 320, 320, true, 0,0,0,0);

                gl.createImageTexture('img', img);                
                
                gl.createTileMap('map', 'img', img.width / 16, 40, 16, 16, 1, 8, layers)

                gl.render();
            }

            function sleep(time) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => resolve(), time);
                })
            }

            function loadImage(url) {
                return new Promise((resolve, reject) => {
                    let i = new Image();
                    i.onload = () => resolve(i);
                    i.src = url;
                })
            }

            async function loadJson(url) {
                let json = await fetch(url);
                return json.json();
            }

            function parseMap(json){
                let layers = [];
                for(let layer of json.layers){
                    if(layer.type==='tilelayer'){
                        layers.push(layer.data);
                    }
                }
                return layers.reverse();
            }
        </script>
    </body>
</html>